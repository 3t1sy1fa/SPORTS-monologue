<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="naver-site-verification" content="2b5866b9f8fde114c370fca27185fb6a7a1ea7d5" />
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">

  {% if slug %}
    {% set safeSlug = slug %}
  {% else %}
    {% set safeSlug = 'default' %}
  {% endif %}

  <title>{{ title or "구단 분석" }} | Sports Monologue</title>
  <meta name="description" content="{{ description or (title ~ ' 전력 분석 및 경기 리뷰') }}">

  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ title or '구단 분석' }}">
  <meta property="og:description" content="{{ description or (title ~ ' 전력 분석 및 경기 리뷰') }}">
  <meta property="og:image" content="/images/og/{{ safeSlug }}.jpg">
  <meta property="og:url" content="https://3t1sy1fa.com{{ page.url }}">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ title or '구단 분석' }}">
  <meta name="twitter:description" content="{{ description or (title ~ ' 전력 분석 및 경기 리뷰') }}">
  <meta name="twitter:image" content="/images/og/{{ safeSlug }}.jpg">
  <meta name="twitter:domain" content="Sports Monologue">

  <link rel="stylesheet" href="/style/main.css" />
  <link rel="stylesheet" href="/style/teams.css" />
  <link rel="stylesheet" href="/style/team-{{ safeSlug }}.css" />
</head>

<body>
  {% include "header.njk" %}

  {# ✅ leagueSchedule 안전 처리 #}
  {% if leagueSchedule and leagueSchedule is iterable %}
    {% set scheduleArray = leagueSchedule %}
  {% else %}
    {% set scheduleArray = [] %}
  {% endif %}

  {% set games = scheduleArray | teamGames(safeSlug) %}
  {% set recentGame = games | getRecentGame %}
  {% set homepage = '' %}
  {% if teamsBoard %}
    {% set homepage = teamsBoard | getHomepage(safeSlug) %}
  {% endif %}

  {# ✅ collections.teamPosts 안전 처리 #}
  {% if collections.teamPosts %}
    {% set postsArray = collections.teamPosts %}
  {% else %}
    {% set postsArray = [] %}
  {% endif %}
  {% set filteredPosts = postsArray | getTeamPosts(safeSlug) %}

  <main class="team-layout">
    <!-- 팀 헤더 -->
    <section class="team-header">
      <img src="/images/{{ safeSlug }}.png" alt="{{ title }}" class="team-logo-large">
      <div class="team-meta">
        <h1>{{ title }}</h1>
        <p class="team-slogan">경영의 언어로 분석하는 {{ title }}</p>
      </div>
    </section>

    <div class="team-content">
      <!-- 왼쪽 패널 -->
      <aside class="team-left">
        <div class="recent-game-card">
          <h3>최근 경기 결과</h3>
          {% if recentGame %}
            <div class="match-score">
              <span class="home">{{ recentGame.home }} ({{ recentGame.homeScore }})</span>
              <strong>vs</strong>
              <span class="away">{{ recentGame.away }} ({{ recentGame.awayScore }})</span>
            </div>
            <p class="game-date">{{ recentGame.date | date }}</p>
          {% else %}
            <p class="no-data">최근 경기 정보가 없습니다.</p>
          {% endif %}
          {% if homepage %}
            <a href="{{ homepage }}" class="team-btn" target="_blank" rel="noopener noreferrer">
              구단 공식 홈페이지
            </a>
          {% endif %}
        </div>

        <div class="analysis-list">
          <h3>구단 분석 아카이브</h3>
          {% if filteredPosts | length > 0 %}
            {% for post in filteredPosts %}
              <article class="analysis-card">
                <a href="{{ post.url }}">
                  <h4>{{ post.data.title }}</h4>
                  <time>{{ post.date | date }}</time>
                </a>
              </article>
            {% endfor %}
          {% else %}
            <p class="no-data">등록된 구단 분석글이 없습니다.</p>
          {% endif %}
        </div>
      </aside>

      <!-- 오른쪽 본문 -->
      <section class="team-right">
        {{ content | safe }}
      </section>
    </div>
  </main>

  {% include "footer.njk" %}
</body>
</html>