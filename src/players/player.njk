---
pagination:
  data: players
  size: 1
  alias: player
permalink: "players/{{ player.slug }}/index.html"
layout: layout.njk
---

{% block styles %}
<link rel="stylesheet" href="/style/player-detail.css" />
{% endblock %}

{% block content %}
<section class="player-detail-container">
  <header class="player-header">
    <img 
      src="/images/players/{{ player.slug or 'default' }}.png" 
      alt="{{ player.name or '이름 없음' }}" 
      class="player-photo">
    <div class="player-info">
      <h1>{{ player.name or '이름 없음' }}</h1>
      <p class="player-position">{{ player.position or '포지션 정보 없음' }}</p>
      <p class="player-number">등번호: {{ player.number or '-' }}</p>
      {% if player.note %}
        <p class="player-note">"{{ player.note }}"</p>
      {% endif %}
    </div>
  </header>

  {# ================== 최근 경기 기록 ================== #}
  <section class="player-stats">
    <h2>최근 경기 기록</h2>
    <table class="stats-table">
      <thead>
        <tr>
          <th>날짜</th>
          <th>경기</th>
          <th>기록</th>
          <th>평점</th>
        </tr>
      </thead>
      <tbody>
        {% if playerStats and (playerStats is iterable) %}
          {% for stat in playerStats %}
            {% if stat and stat.playerSlug == player.slug %}
              <tr>
                <td>
                  <time datetime="{{ stat.date }}">{{ stat.date | date("MM.dd") }}</time>
                </td>
                <td>{{ stat.game or '경기 정보 없음' }}</td>
                <td>{{ stat.record or '-' }}</td>
                <td>{{ stat.rating or '-' }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4">경기 기록이 없습니다.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </section>

  {# ================== 인기 투표 ================== #}
  <section class="player-votes">
    <h2>인기 투표</h2>
    {% if voteSummary and voteSummary.players and (voteSummary.players is iterable) %}
      {% set playerVotes = voteSummary.players %}
    {% else %}
      {% set playerVotes = [] %}
    {% endif %}

    {% set playerVote = playerVotes | selectattr("playerSlug", "equalto", player.slug) | first %}
    {% set count = playerVote ? (playerVote.playerTotalVotes or 0) : 0 %}

    <p>현재 투표 수: {{ count }}표</p>
    <button class="vote-btn" data-type="player" data-slug="{{ player.slug }}">
      이 선수에게 투표하기
    </button>
  </section>
</section>

<script type="module">
  import { handleVote } from "/scripts/voteHandler.js";
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".vote-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const type = btn.dataset.type;
        const slug = btn.dataset.slug;
        if (!type || !slug) {
          console.error("투표 데이터가 올바르지 않습니다.", { type, slug });
          return;
        }
        handleVote(type, slug);
      });
    });
  });
</script>
{% endblock %}