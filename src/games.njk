---
layout: layout.njk
title: ê²½ê¸° ë¶„ì„
description: "KBO ë¦¬ê·¸ ì£¼ìš” ê²½ê¸° íë¦„ê³¼ ì „ëµì„ í•´ì„í•˜ë©° ì „ë ¥ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤."
---

{% block styles %}
<link rel="stylesheet" href="/style/team-base.css" />
<link rel="stylesheet" href="/style/analysis.css" />
{% endblock %}

{% block content %}
<section class="analysis-container" aria-labelledby="analysis-title">
  <header class="analysis-header">
    <h1 id="analysis-title">ê²½ê¸° ë¶„ì„</h1>
    <p class="subtitle">KBO ë¦¬ê·¸ ì£¼ìš” ê²½ê¸° íë¦„ê³¼ ì „ëµì„ í•´ì„í•©ë‹ˆë‹¤.</p>
  </header>

  <div class="analysis-grid">
    <!-- ì™¼ìª½: ì´ë²ˆ ì£¼ ê²½ê¸° ì¼ì • -->
    <aside class="weekly-schedule card">
      <h2>ì´ë²ˆ ì£¼ ê²½ê¸° ì¼ì •</h2>
      <ul class="schedule-list">
        {% for day in weekDates %}
          {% if day.games and (day.games | length) > 0 %}
            <li class="schedule-day">
              <strong class="schedule-date">{{ day.date | date("MM.dd (EEE)") }}</strong>

              {% for game in day.games %}
                <div class="match">
                  {# í™ˆíŒ€ #}
                  {% set homeClass = "team" %}
                  {% if game.winner and game.homeScore > game.awayScore %}
                    {% set homeClass = "team winner" %}
                  {% elseif game.winner and game.homeScore < game.awayScore %}
                    {% set homeClass = "team loser" %}
                  {% endif %}

                  {# ì›ì •íŒ€ #}
                  {% set awayClass = "team" %}
                  {% if game.winner and game.awayScore > game.homeScore %}
                    {% set awayClass = "team winner" %}
                  {% elseif game.winner and game.awayScore < game.homeScore %}
                    {% set awayClass = "team loser" %}
                  {% endif %}

                  <span class="{{ homeClass }}">
                    <img src="/images/s{{ game.homeSlug }}.png" alt="{{ game.home }}" class="team-logo" loading="lazy" decoding="async">
                    {{ game.home }}
                  </span>

                  <span class="vs">vs</span>

                  <span class="{{ awayClass }}">
                    <img src="/images/s{{ game.awaySlug }}.png" alt="{{ game.away }}" class="team-logo" loading="lazy" decoding="async">
                    {{ game.away }}
                  </span>

                  <span class="score">
                    {% if game.homeScore != null and game.awayScore != null %}
                      {{ game.homeScore }} : {{ game.awayScore }}
                    {% else %}
                      ì˜ˆì •
                    {% endif %}
                  </span>
                </div>
              {% endfor %}
            </li>
          {% else %}
            <li class="schedule-day no-games">
              <strong class="schedule-date">{{ day.date | date("MM.dd (EEE)") }}</strong>
              <span>ê²½ê¸° ì—†ìŒ</span>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </aside>

    <!-- ì˜¤ë¥¸ìª½: í¬ë””ì›€ + ì¹´ë“œ -->
    <div class="right-content">
      <!-- ğŸ† ì¸ê¸° êµ¬ë‹¨ í¬ë””ì›€ -->
      <section class="vote-podium-section card">
        <h2>ì¸ê¸° ìˆœìœ„</h2>
        {% if topTeams and (topTeams | length) > 0 %}
          <div class="podium-wrapper">
            {% for team in topTeams %}
              <div class="podium-card podium-{{ loop.index }}">
                <img src="/images/{{ team.teamSlug }}.png" alt="{{ team.teamName }}" class="team-logo" loading="lazy" decoding="async">
                <div class="team-info">
                  <h3>{{ loop.index }}ìœ„ {{ team.teamName }}</h3>
                  <p>{{ team.teamTotalVotes }}í‘œ</p>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="no-data">íˆ¬í‘œ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>
        {% endif %}
      </section>

      <!-- ğŸ“‹ ì „ì²´ êµ¬ë‹¨ ì¹´ë“œ -->
      {% if voteSummary and voteSummary.teams and voteSummary.teams is iterable %}
        {% set voteTeams = voteSummary.teams %}
      {% else %}
        {% set voteTeams = [] %}
      {% endif %}

      <section class="teams-card-section card">
        <h2>ì „ì²´ êµ¬ë‹¨</h2>
        <div class="teams-card-grid">
          {% for team in teamsBoard | sort(attribute="rank") %}
            {% set voteCount = 0 %}
            {% for vote in voteTeams %}
              {% if vote.teamSlug == team.slug %}
                {% set voteCount = vote.teamTotalVotes %}
              {% endif %}
            {% endfor %}

            <div class="team-card team-{{ team.slug }}">
              <a class="team-card-link" href="/teams/{{ team.slug }}/">
                <img src="/images/{{ team.slug }}.png" alt="{{ team.name }}" class="team-card-logo" loading="lazy" decoding="async">
                <div class="team-info">
                  <h3>{{ team.name }}</h3>
                  <p class="muted">
                    ìˆœìœ„: {{ team.rank }}ìœ„ Â· ìŠ¹ë¥ : {{ (team.winRate * 100) | round(1) }}%
                  </p>
                  <span class="last-game
                    {% if team.lastGame == 'ìŠ¹' %}win
                    {% elseif team.lastGame == 'íŒ¨' %}lose
                    {% elseif team.lastGame == 'ë¬´' %}draw
                    {% endif %}">
                    ìµœê·¼ ê²½ê¸°: {{ team.lastGame }}
                  </span>
                  <span class="vote-count">íˆ¬í‘œ ìˆ˜: {{ voteCount }}í‘œ</span>
                </div>
              </a>
              <button class="vote-btn" data-type="team" data-slug="{{ team.slug }}">
                ì´ êµ¬ë‹¨ì— íˆ¬í‘œí•˜ê¸°
              </button>
            </div>
          {% endfor %}
        </div>
      </section>

      <!-- âœï¸ ê²½ê¸° ë¶„ì„ ê¸€ ëª©ë¡ (collections.postsì—ì„œ ë°”ë¡œ í•„í„°ë§) -->
      <section class="analysis-list-section card">
        <h2>ìµœì‹  ê²½ê¸° ë¶„ì„</h2>
        {% set postsArr = collections.posts or [] %}
        {% set anyPost = false %}
        <div class="analysis-list">
          {% for post in postsArr | reverse %}
            {% if post.data and post.data.category == "ê²½ê¸° ë¶„ì„" %}
              {% set anyPost = true %}
              <article class="analysis-item">
                <h3 class="analysis-title">
                  <a href="{{ post.url }}" title="{{ post.data.title }}">
                    {{ post.data.title }}
                  </a>
                </h3>
                <div class="analysis-meta">
                  <span class="category">[{{ post.data.category }}]</span>
                  <time datetime="{{ post.date | date('YYYY-MM-DD') }}">
                    {{ post.date | date('YYYY.MM.DD') }}
                  </time>
                </div>
                {% if post.data.excerpt %}
                  <p class="analysis-excerpt">{{ post.data.excerpt }}</p>
                {% endif %}
              </article>
            {% endif %}
          {% endfor %}

          {% if not anyPost %}
            <p class="no-data">ì•„ì§ â€˜ê²½ê¸° ë¶„ì„â€™ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ê³§ ì—…ë°ì´íŠ¸ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
          {% endif %}
        </div>
      </section>
    </div>
  </div>
</section>

<script type="module">
  import { handleVote } from "/scripts/voteHandler.js";
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".vote-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        handleVote(btn.dataset.type, btn.dataset.slug);
      });
    });
  });
</script>
{% endblock %}