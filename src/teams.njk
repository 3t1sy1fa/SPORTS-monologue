---
layout: layout.njk
title: êµ¬ë‹¨ ë¶„ì„
description: "KBO 10ê°œ êµ¬ë‹¨ì˜ ì „ë ¥ ë¶„ì„, ê²½ê¸° ì¼ì •, ìµœì‹  ë‰´ìŠ¤ì™€ ì¸ê¸° êµ¬ë‹¨ ìˆœìœ„ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”."
---

{% block styles %}
<link rel="stylesheet" href="/style/team-base.css" />
{% endblock %}

{% block content %}
<h1 class="page-title">êµ¬ë‹¨ ë¶„ì„</h1>

{# ğŸ† ì¸ê¸° êµ¬ë‹¨ í¬ë””ì›€ (TOP 3) #}
{% if voteSummary and voteSummary.teams %}
  {% set voteTeams = voteSummary.teams %}
{% else %}
  {% set voteTeams = [] %}
{% endif %}

{% set topTeams = voteTeams | sort(attribute="teamTotalVotes") | reverse | slice(0, 3) %}

<section class="vote-podium-section">
  <h2>ì¸ê¸° êµ¬ë‹¨ í¬ë””ì›€</h2>
  {% if topTeams | length > 0 %}
    <div class="podium-wrapper">
      {% for team in topTeams %}
        <div class="podium-card podium-{{ loop.index }}">
          <img src="/images/{{ team.teamSlug }}.png" alt="{{ team.teamName }}" class="team-logo">
          <div class="team-info">
            <h3>{{ loop.index }}ìœ„ {{ team.teamName }}</h3>
            <p>{{ team.teamTotalVotes }}í‘œ</p>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-data">íˆ¬í‘œ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>
  {% endif %}
</section>

{# ===============================
   ğŸŸï¸ ì´ë²ˆ ì£¼ ê²½ê¸° ì¼ì • (7ì¹¸ ìº˜ë¦°ë”)
   =============================== #}
{% if leagueSchedule and leagueSchedule is iterable %}
  {% set scheduleArray = leagueSchedule %}
{% else %}
  {% set scheduleArray = [] %}
{% endif %}

{# ì´ë²ˆ ì£¼ ì›”ìš”ì¼ ~ ì¼ìš”ì¼ ë‚ ì§œ ë°°ì—´ ìƒì„± #}
{% set weekDates = [] %}
{% set startOfWeek = ("now" | date("timestamp") - ((("now" | date("EEE")) | lower == "mon") ? 0 : (("now" | date("EEE")) | date("u") - 1) * 24 * 60 * 60 * 1000)) %}
{% for i in (0..6) %}
  {% set date = (startOfWeek + (i * 24 * 60 * 60 * 1000)) | date("yyyy-MM-dd") %}
  {% set weekDates = weekDates.concat([date]) %}
{% endfor %}

<section class="calendar-section">
  <h2>ì´ë²ˆ ì£¼ ê²½ê¸° ì¼ì •</h2>
  <div class="calendar-grid">
    {% for day in weekDates %}
      {% set games = scheduleArray 
        | selectattr("date", "equalto", day) 
        | sort(attribute="home") %}
      <div class="calendar-day">
        <h3>{{ day | date("MM.dd (EEE)") }}</h3>
        {% if games | length > 0 %}
          <div class="matches">
            {% for game in games %}
              <div class="match-logos">
                <img src="/images/{{ game.homeSlug }}.png" alt="{{ game.home }}" class="team-logo">
                <img src="/images/{{ game.awaySlug }}.png" alt="{{ game.away }}" class="team-logo">
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="no-game">ê²½ê¸° ì—†ìŒ</p>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</section>

{# ğŸ“‹ ì „ì²´ êµ¬ë‹¨ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ #}
{% if teamsBoard and teamsBoard is iterable %}
  {% set teamsArray = teamsBoard %}
{% else %}
  {% set teamsArray = [] %}
{% endif %}

<section class="teams-card-section">
  {% for team in teamsArray | sort(attribute="rank") %}
    {% set voteCount = 0 %}
    {% for vote in voteTeams %}
      {% if vote.teamSlug == team.slug %}
        {% set voteCount = vote.teamTotalVotes %}
      {% endif %}
    {% endfor %}
    <div class="team-card team-{{ team.slug }}">
      <a href="/teams/{{ team.slug }}/">
        <img src="/images/{{ team.slug }}.png" alt="{{ team.name }}">
        <div class="team-info">
          <h3>{{ team.name }}</h3>
          <p>ìˆœìœ„: {{ team.rank }}ìœ„ | ìŠ¹ë¥ : {{ (team.winRate * 100) | round(1) }}%</p>
          <span class="last-game 
            {% if team.lastGame == 'ìŠ¹' %}win
            {% elseif team.lastGame == 'íŒ¨' %}lose
            {% elseif team.lastGame == 'ë¬´' %}draw
            {% endif %}">
            ìµœê·¼ ê²½ê¸°: {{ team.lastGame }}
          </span>
          <span class="vote-count">íˆ¬í‘œ ìˆ˜: {{ voteCount }}í‘œ</span>
        </div>
      </a>
      <button class="vote-btn" data-type="team" data-slug="{{ team.slug }}">
        ì´ êµ¬ë‹¨ì— íˆ¬í‘œí•˜ê¸°
      </button>
    </div>
  {% endfor %}
</section>

<script type="module">
  import { handleVote } from "/scripts/voteHandler.js";
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".vote-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        handleVote(btn.dataset.type, btn.dataset.slug);
      });
    });
  });
</script>
{% endblock %}