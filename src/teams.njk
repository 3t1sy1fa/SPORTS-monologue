---
layout: layout.njk
title: êµ¬ë‹¨ ë¶„ì„
description: "KBO 10ê°œ êµ¬ë‹¨ì˜ ì „ë ¥ ë¶„ì„, ê²½ê¸° ì¼ì •, ìµœì‹  ë‰´ìŠ¤ì™€ ì¸ê¸° êµ¬ë‹¨ ìˆœìœ„ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”."
---

{% block styles %}
<link rel="stylesheet" href="/style/team-base.css" />
{% endblock %}

{% block content %}
<h1 class="page-title">êµ¬ë‹¨ ë¶„ì„</h1>

{# ================== ğŸ† ì¸ê¸° êµ¬ë‹¨ TOP3 ================== #}
{% if voteSummary and voteSummary.teams and (voteSummary.teams is iterable) %}
  {% set voteTeams = voteSummary.teams %}
{% else %}
  {% set voteTeams = [] %}
{% endif %}

{% if voteTeams | length > 0 %}
  {% set topTeams = voteTeams | sort(attribute="teamTotalVotes", order="desc") %}
{% else %}
  {% set topTeams = [] %}
{% endif %}

<section class="podium-section">
  {% if topTeams | length > 0 %}
    {% for team in topTeams | slice(0, 3) %}
      {% if team and team.teamSlug and team.teamName %}
        <div class="podium podium-{{ loop.index }} team-{{ team.teamSlug }}">
          <img src="/images/{{ team.teamSlug }}.png" alt="{{ team.teamName }}">
          <span>{{ team.teamName }}</span>
          <span class="vote-count">{{ team.teamTotalVotes or 0 }}í‘œ</span>
        </div>
      {% endif %}
    {% endfor %}
  {% else %}
    <p class="no-data">ì¸ê¸° êµ¬ë‹¨ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>
  {% endif %}
</section>

{# ================== ğŸ“Š êµ¬ë‹¨ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ================== #}
{% if teamsBoard and (teamsBoard is iterable) %}
  {% set teamsArray = teamsBoard %}
{% else %}
  {% set teamsArray = [] %}
{% endif %}

<section class="teams-card-section">
  {% for team in teamsArray | sort(attribute="rank") %}
    {% if team and team.slug %}
      {% set vote = voteTeams | selectattr("teamSlug", "equalto", team.slug) | first %}
      {% set count = vote ? (vote.teamTotalVotes or 0) : 0 %}
      <div class="team-card team-{{ team.slug }}">
        <a href="/teams/{{ team.slug }}/">
          <img src="/images/{{ team.slug }}.png" alt="{{ team.name or 'íŒ€ëª… ì—†ìŒ' }}">
          <div class="team-info">
            <h3>{{ team.name or 'íŒ€ëª… ì—†ìŒ' }}</h3>
            <p>ìˆœìœ„: {{ team.rank or '-' }}ìœ„ | ìŠ¹ë¥ : {{ team.winRate or '-' }}</p>
            <span class="last-game">ìµœê·¼ ê²½ê¸°: {{ team.lastGame or 'ì •ë³´ ì—†ìŒ' }}</span>
            <span class="vote-count">íˆ¬í‘œ ìˆ˜: {{ count }}í‘œ</span>
          </div>
        </a>
        <button class="vote-btn" data-type="team" data-slug="{{ team.slug }}">
          ì´ êµ¬ë‹¨ì— íˆ¬í‘œí•˜ê¸°
        </button>
      </div>
    {% endif %}
  {% endfor %}
</section>

{# ================== ğŸ“… ì´ë²ˆ ì£¼ ê²½ê¸° ì¼ì • ================== #}
{% if leagueSchedule and (leagueSchedule is iterable) %}
  {% set scheduleArray = leagueSchedule %}
{% else %}
  {% set scheduleArray = [] %}
{% endif %}

<section class="extra-info">
  <div class="weekly-schedule">
    <h3>ì´ë²ˆ ì£¼ ê²½ê¸° ì¼ì •</h3>
    {% set today = now | date("yyyy-MM-dd") %}
    {% set upcomingGames = scheduleArray 
      | selectattr("date", "ge", today)
      | slice(0, 7) 
    %}
    {% if upcomingGames and upcomingGames | length > 0 %}
      <ul>
        {% for game in upcomingGames %}
          {% if game %}
            <li>
              <time datetime="{{ game.date }}">{{ game.date | date("MM.dd") }}</time>
              {{ game.home or 'í™ˆíŒ€' }} ({{ game.homeScore or "-" }}) 
              vs 
              {{ game.away or 'ì›ì •íŒ€' }} ({{ game.awayScore or "-" }})
              <span class="status">{{ game.status or '' }}</span>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    {% else %}
      <p class="no-data">ì´ë²ˆ ì£¼ ê²½ê¸° ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>
</section>

<script type="module">
  import { handleVote } from "/scripts/voteHandler.js";
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".vote-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const type = btn.dataset.type;
        const slug = btn.dataset.slug;
        if (!type || !slug) {
          console.error("íˆ¬í‘œ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", { type, slug });
          return;
        }
        handleVote(type, slug);
      });
    });
  });
</script>
{% endblock %}